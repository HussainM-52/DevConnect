<%- include("partials/header.ejs") %>

<style>
    .checks {
      display: none;
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 5px;
      background: #f9f9f9;
      width: 300px;
    }
    .checks ul {
      list-style: none;
      padding: 0;
    }
    .checks li {
      margin-bottom: 5px;
    }
    .valid {
      color: green;
    }
    .invalid {
      color: red;
    }
    #goodToGo {
      display: none;
      color: green;
      margin-top: 10px;
    }
  </style>
<main>
  <form id="signupForm" action="/change-password" method="POST">
    <input type="password" id="password" name="password" placeholder="Enter your password" autocomplete="off" required>

    <div class="checks" id="checksBox">
      <ul>
        <li id="length" class="invalid">❌ Minimum 8 characters</li>
        <li id="lower" class="invalid">❌ At least 1 lowercase letter</li>
        <li id="upper" class="invalid">❌ At least 1 uppercase letter</li>
        <li id="digit" class="invalid">❌ At least 1 number</li>
        <li id="special" class="invalid">❌ At least 1 special character (@$!%*?&_)</li>
      </ul>
    </div>
    <div id="goodToGo">✅ Good to go!</div>

     <input type="password" name="confirmPassword" id="confirmPassword" placeholder="Confirm your password" autocomplete="off" required disabled>
     <div id="confirmError" style="color: red;"></div>
    <button type="submit" id="submitBtn" disabled>Change Password</button>
  </form>
</main>
<script>
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const checksBox = document.getElementById('checksBox');
    const goodToGo = document.getElementById('goodToGo');
    const submitBtn = document.querySelector('#submitBtn');
    const confirmError = document.getElementById('confirmError');

    const checks = {
      length: document.getElementById('length'),
      lower: document.getElementById('lower'),
      upper: document.getElementById('upper'),
      digit: document.getElementById('digit'),
      special: document.getElementById('special'),
    };

    passwordInput.addEventListener('input', () => {
      const pwd = passwordInput.value;

      // Show the box when user starts typing
      checksBox.style.display = pwd ? 'block' : 'none';

      const lengthCheck = pwd.length >= 8;
      const lowerCheck = /[a-z]/.test(pwd);
      const upperCheck = /[A-Z]/.test(pwd);
      const digitCheck = /\d/.test(pwd);
      const specialCheck = /[@$!%*?&_]/.test(pwd);

      updateCheck('length', lengthCheck);
      updateCheck('lower', lowerCheck);
      updateCheck('upper', upperCheck);
      updateCheck('digit', digitCheck);
      updateCheck('special', specialCheck);

      const allPassed = lengthCheck && lowerCheck && upperCheck && digitCheck && specialCheck;

      if (allPassed) {
        checksBox.style.display = 'none';
        goodToGo.style.display = 'block';
        confirmPasswordInput.disabled = false;
      } else {
        goodToGo.style.display = 'none';
        confirmPasswordInput.disabled = true;
        confirmPasswordInput.value = '';
        submitBtn.disabled = true;
      }
    });

    confirmPasswordInput.addEventListener('input', () => {
      if (confirmPasswordInput.value === passwordInput.value) {
        confirmError.textContent = '';
        submitBtn.disabled = false;
      } else {
        confirmError.textContent = 'Passwords do not match!';
        submitBtn.disabled = true;
      }
    });

    function updateCheck(id, isValid) {
      checks[id].className = isValid ? 'valid' : 'invalid';
      checks[id].textContent = (isValid ? '✅' : '❌') + ' ' + checks[id].textContent.slice(2);
    }

    document.getElementById('signupForm').addEventListener('submit', (e) => {
      if (submitBtn.disabled) {
        e.preventDefault();
      } else {
        document.getElementById('signupForm').submit();
      }
    });
  </script>

<%- include("partials/footer.ejs") %>